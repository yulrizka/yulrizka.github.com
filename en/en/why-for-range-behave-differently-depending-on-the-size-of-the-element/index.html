<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Why for-range behaves differently depending on the size of the element (A peek into go compiler optimization) - </title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="Understanding the go SSA optimization using for-range example">
		<meta property="og:url" content="https://labs.yulrizka.com/en/en/why-for-range-behave-differently-depending-on-the-size-of-the-element/">
  <meta property="og:title" content="Why for-range behaves differently depending on the size of the element (A peek into go compiler optimization)">
  <meta property="og:description" content="Understanding the go SSA optimization using for-range example">
  <meta property="og:locale" content="en_US">
  <meta property="og:type" content="article">
    <meta property="article:section" content="en">
    <meta property="article:published_time" content="2020-04-25T15:47:49+02:00">
    <meta property="article:modified_time" content="2020-04-25T15:47:49+02:00">
    <meta property="article:tag" content="Golang">

		
  <meta itemprop="name" content="Why for-range behaves differently depending on the size of the element (A peek into go compiler optimization)">
  <meta itemprop="description" content="Understanding the go SSA optimization using for-range example">
  <meta itemprop="datePublished" content="2020-04-25T15:47:49+02:00">
  <meta itemprop="dateModified" content="2020-04-25T15:47:49+02:00">
  <meta itemprop="wordCount" content="1680">
  <meta itemprop="keywords" content="golang,,ssa,,optimization">
		
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Why for-range behaves differently depending on the size of the element (A peek into go compiler optimization)">
  <meta name="twitter:description" content="Understanding the go SSA optimization using for-range example">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo logo--mixed">
		<a class="logo__link" href="/en/" title="Ahmy&#39;s Laboratory" rel="home">
			<div class="logo__item logo__imagebox">
					<img class="logo__img" src="/img/ahmy.jpg">
				</div><div class="logo__item logo__text">
					<div class="logo__title">Ahmy&#39;s Laboratory</div>
					<div class="logo__tagline">Random thoughts and rumblings. All opinions are my own.</div>
				</div>
		</a>
	</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">Menu</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/en/en/cv/">
				
				<span class="menu__text">Curriculum vitae</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Why for-range behaves differently depending on the size of the element (A peek into go compiler optimization)</h1>
			<div class="post__meta meta"><div class="meta__item-author meta__item">
	<svg class="meta__icon icon icon-author" width="16" height="16" viewBox="0 0 16 16"><path d="M8 1c2 0 3.5 2 3.5 4.5S10 9 10 9c3 1 4 2 4 6H2c0-4 1-5 4-6 0 0-1.5-1-1.5-3.5S6 1 8 1"/></svg><span class="meta__text">Ahmy Yulrizka</span>
</div>
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0a14 14 0 1 1 0 28 1 1 0 0 1 0-28m0 3a3 3 0 1 0 0 22 3 3 0 0 0 0-22m1 4h-2v8.4l6.8 4.4L22 18l-6-3.8z"/></svg><time class="meta__text" datetime="2020-04-25T15:47:49&#43;02:00">2020-04-25</time></div></div>
		</header>
		
<div class="post__toc toc">
	<div class="toc__title">Page content</div>
	<div class="toc__menu">
		<nav id="TableOfContents">
  <ul>
    <li><a href="#generating-assembly-code">Generating Assembly Code</a></li>
    <li><a href="#ssa-optimization">SSA Optimization</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav>
	</div>
</div><div class="content post__content clearfix">
			<p>It&rsquo;s all started when my colleague asked this question.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span><span style="color:#f92672">import</span> <span style="color:#e6db74">&#34;testing&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">size</span> = <span style="color:#ae81ff">1000000</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">SomeStruct</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>	<span style="color:#a6e22e">ID0</span> <span style="color:#66d9ef">int64</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>	<span style="color:#a6e22e">ID1</span> <span style="color:#66d9ef">int64</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>	<span style="color:#a6e22e">ID2</span> <span style="color:#66d9ef">int64</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>	<span style="color:#a6e22e">ID3</span> <span style="color:#66d9ef">int64</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>	<span style="color:#a6e22e">ID4</span> <span style="color:#66d9ef">int64</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>	<span style="color:#a6e22e">ID5</span> <span style="color:#66d9ef">int64</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span>	<span style="color:#a6e22e">ID6</span> <span style="color:#66d9ef">int64</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span>	<span style="color:#a6e22e">ID7</span> <span style="color:#66d9ef">int64</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span>	<span style="color:#a6e22e">ID8</span> <span style="color:#66d9ef">int64</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span><span>}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">BenchmarkForVar</span>(<span style="color:#a6e22e">b</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">B</span>) {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span><span>    <span style="color:#a6e22e">slice</span> <span style="color:#f92672">:=</span> make([]<span style="color:#a6e22e">SomeStruct</span>, <span style="color:#a6e22e">size</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span><span>    <span style="color:#a6e22e">b</span>.<span style="color:#a6e22e">ReportAllocs</span>()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span><span>    <span style="color:#a6e22e">b</span>.<span style="color:#a6e22e">ResetTimer</span>()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#a6e22e">b</span>.<span style="color:#a6e22e">N</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span><span>        <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">s</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">slice</span> { <span style="color:#75715e">// index and value
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span><span><span style="color:#75715e"></span>            <span style="color:#a6e22e">_</span> = <span style="color:#a6e22e">s</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span><span>        }
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span><span>    }
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span><span>}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">BenchmarkForCounter</span>(<span style="color:#a6e22e">b</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">B</span>) {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30</span><span>    <span style="color:#a6e22e">slice</span> <span style="color:#f92672">:=</span> make([]<span style="color:#a6e22e">SomeStruct</span>, <span style="color:#a6e22e">size</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31</span><span>    <span style="color:#a6e22e">b</span>.<span style="color:#a6e22e">ReportAllocs</span>()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32</span><span>    <span style="color:#a6e22e">b</span>.<span style="color:#a6e22e">ResetTimer</span>()
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33</span><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#a6e22e">b</span>.<span style="color:#a6e22e">N</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34</span><span>        <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">slice</span> { <span style="color:#75715e">// only use the index
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35</span><span><span style="color:#75715e"></span>            <span style="color:#a6e22e">s</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">slice</span>[<span style="color:#a6e22e">i</span>]
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36</span><span>            <span style="color:#a6e22e">_</span> = <span style="color:#a6e22e">s</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37</span><span>        }
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38</span><span>    }
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39</span><span>}
</span></span></code></pre></div><p>Which one do you think is faster?</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>$ go test -bench .
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>goos: linux
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>goarch: amd64
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span>BenchmarkForVar-4       	    4363	    269711 ns/op	       0 B/op	       0 allocs/op
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span>BenchmarkForCounter-4   	    4195	    285952 ns/op	       0 B/op	       0 allocs/op
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span><span>PASS
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7</span><span>ok  	_/test1	2.685s
</span></span></code></pre></div><p>It&rsquo;s pretty much the same. However, if we increase the size of the struct by adding another field <code>ID9 int64</code>
The result becomes significantly different.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>$ go test -bench .
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>goos: linux
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>goarch: amd64
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span>BenchmarkForVar-4       	     282	   4264872 ns/op	       0 B/op	       0 allocs/op
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span>BenchmarkForCounter-4   	    4363	    269761 ns/op	       0 B/op	       0 allocs/op
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span><span>PASS
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7</span><span>ok  	_/test1	3.255s
</span></span></code></pre></div><br />
This problem become intriguing, so I dig a little deeper. I would like to point out that the code is a contrived example.
It would probably not applied in a production code. I am **not** going to focus on the benchmark or which for-range works
better but rather exploring how Go compiles and demonstrating useful Go tools in the process.
<p>The code below also contains some assembly code. I am not going into too much detail, so I would not worry if you are not familiar with it.
My intention is to show how the generated code differs and what could be the reason for it.</p>
<p>I am going to focus on <code>for _, s = range slice</code> loop (ForVar). To make it simpler I create a <code>main.go</code> and <code>struct.go</code></p>
<p><strong>main.go</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>	<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">size</span> = <span style="color:#ae81ff">1000000</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>	<span style="color:#a6e22e">slice</span> <span style="color:#f92672">:=</span> make([]<span style="color:#a6e22e">SomeStruct</span>, <span style="color:#a6e22e">size</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">s</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">slice</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>		<span style="color:#a6e22e">_</span> = <span style="color:#a6e22e">s</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>	}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>}
</span></span></code></pre></div><p>I&rsquo;ll skip the <code>struct.go</code> here since it&rsquo;s pretty trivial.</p>
<h2 id="generating-assembly-code">Generating Assembly Code</h2>
<p>To look into what instructions are generated, we can use <code>go tool compile -S</code>. This will print out the generated
assembly code to stdout. I also Skipped some lines that are not directly related to our code.</p>
<p>according to <a href="https://golang.org/doc/asm">asm package doc</a></p>
<blockquote>
<p>The FUNCDATA and PCDATA directives contain information for use by the garbage collector; they are introduced by the compiler.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>$  go tool compile -S main.go type.go | grep -v FUNCDATA | grep -v PCDATA
</span></span></code></pre></div><p>Here are the generated assembly code for both version.</p>
<p><strong>version with 9 int64</strong></p>
<p>This struct contains 9 int64 and has the size 72 bytes</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span><span style="color:#960050;background-color:#1e0010">&#34;&#34;</span><span style="color:#a6e22e">.main</span> <span style="color:#66d9ef">STEXT</span> <span style="color:#66d9ef">size</span><span style="color:#960050;background-color:#1e0010">=</span><span style="color:#ae81ff">93</span> <span style="color:#66d9ef">args</span><span style="color:#960050;background-color:#1e0010">=</span><span style="color:#ae81ff">0x0</span> <span style="color:#66d9ef">locals</span><span style="color:#960050;background-color:#1e0010">=</span><span style="color:#ae81ff">0x28</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>    <span style="color:#a6e22e">...</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>	<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0024</span> <span style="color:#ae81ff">00036</span> (<span style="color:#66d9ef">main_var.go</span>:<span style="color:#ae81ff">6</span>)	<span style="color:#66d9ef">MOVQ</span>	<span style="color:#66d9ef">AX</span>, (<span style="color:#66d9ef">SP</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>	<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0028</span> <span style="color:#ae81ff">00040</span> (<span style="color:#66d9ef">main_var.go</span>:<span style="color:#ae81ff">6</span>)	<span style="color:#66d9ef">MOVQ</span>	<span style="color:#66d9ef">$1000000</span>, <span style="color:#ae81ff">8</span>(<span style="color:#66d9ef">SP</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>	<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0031</span> <span style="color:#ae81ff">00049</span> (<span style="color:#66d9ef">main_var.go</span>:<span style="color:#ae81ff">6</span>)	<span style="color:#66d9ef">MOVQ</span>	<span style="color:#66d9ef">$1000000</span>, <span style="color:#ae81ff">16</span>(<span style="color:#66d9ef">SP</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>	<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x003a</span> <span style="color:#ae81ff">00058</span> (<span style="color:#66d9ef">main_var.go</span>:<span style="color:#ae81ff">6</span>)	<span style="color:#66d9ef">CALL</span>	<span style="color:#66d9ef">runtime.makeslice</span>(<span style="color:#66d9ef">SB</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>	<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x003f</span> <span style="color:#ae81ff">00063</span> (<span style="color:#66d9ef">main_var.go</span>:<span style="color:#ae81ff">6</span>)	<span style="color:#66d9ef">XORL</span>	<span style="color:#66d9ef">AX</span>, <span style="color:#66d9ef">AX</span>       <span style="color:#75715e"># set AX = 0
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span><span style="color:#75715e"></span>	<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0041</span> <span style="color:#ae81ff">00065</span> (<span style="color:#66d9ef">main_var.go</span>:<span style="color:#ae81ff">7</span>)	<span style="color:#66d9ef">INCQ</span>	<span style="color:#66d9ef">AX</span>           <span style="color:#75715e"># AX++
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span><span style="color:#75715e"></span>	<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0044</span> <span style="color:#ae81ff">00068</span> (<span style="color:#66d9ef">main_var.go</span>:<span style="color:#ae81ff">7</span>)	<span style="color:#66d9ef">CMPQ</span>	<span style="color:#66d9ef">AX</span>, <span style="color:#66d9ef">$1000000</span> <span style="color:#75715e"># AX &lt; 1000000
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span><span style="color:#75715e"></span>	<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x004a</span> <span style="color:#ae81ff">00074</span> (<span style="color:#66d9ef">main_var.go</span>:<span style="color:#ae81ff">7</span>)	<span style="color:#66d9ef">JLT</span>	<span style="color:#ae81ff">65</span>               <span style="color:#75715e"># JUMP to 00065 (next iteration)
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">...</span>
</span></span></code></pre></div><p>Here you can see that at line <code>00065</code>, the loop does nothing except increasing the counter. Let&rsquo;s compare it with the
larger struct.</p>
<br/>
**version with 10 int64**
<p>The struct now contains 10 int64 and has the size 80 bytes</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span><span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0000</span> <span style="color:#ae81ff">00000</span> (<span style="color:#66d9ef">main_var.go</span>:<span style="color:#ae81ff">3</span>)	<span style="color:#66d9ef">TEXT</span>	<span style="color:#960050;background-color:#1e0010">&#34;&#34;</span><span style="color:#66d9ef">.main</span>(<span style="color:#66d9ef">SB</span>), <span style="color:#66d9ef">ABIInternal</span>, <span style="color:#66d9ef">$120-0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>    <span style="color:#a6e22e">...</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>	<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0044</span> <span style="color:#ae81ff">00068</span> (<span style="color:#66d9ef">main_var.go</span>:<span style="color:#ae81ff">6</span>)	<span style="color:#66d9ef">XORL</span>	<span style="color:#66d9ef">CX</span>, <span style="color:#66d9ef">CX</span> <span style="color:#75715e"># CX = 0
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span><span style="color:#75715e"></span>	<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0046</span> <span style="color:#ae81ff">00070</span> (<span style="color:#66d9ef">main_var.go</span>:<span style="color:#ae81ff">7</span>)	<span style="color:#66d9ef">JMP</span>	<span style="color:#ae81ff">76</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>	<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0048</span> <span style="color:#ae81ff">00072</span> (<span style="color:#66d9ef">main_var.go</span>:<span style="color:#ae81ff">7</span>)	<span style="color:#66d9ef">ADDQ</span>	<span style="color:#66d9ef">$80</span>, <span style="color:#66d9ef">AX</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>	<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x004c</span> <span style="color:#ae81ff">00076</span> (<span style="color:#66d9ef">main_var.go</span>:<span style="color:#ae81ff">7</span>)	<span style="color:#66d9ef">PCDATA</span>	<span style="color:#66d9ef">$0</span>, <span style="color:#66d9ef">$2</span> <span style="color:#75715e"># setup temporary variable autotmp_7
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span><span style="color:#75715e"></span>	<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x004c</span> <span style="color:#ae81ff">00076</span> (<span style="color:#66d9ef">main_var.go</span>:<span style="color:#ae81ff">7</span>)	<span style="color:#66d9ef">LEAQ</span>	<span style="color:#960050;background-color:#1e0010">&#34;&#34;</span><span style="color:#66d9ef">..autotmp_7</span><span style="color:#960050;background-color:#1e0010">+</span><span style="color:#ae81ff">32</span>(<span style="color:#66d9ef">SP</span>), <span style="color:#66d9ef">DI</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>	<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0051</span> <span style="color:#ae81ff">00081</span> (<span style="color:#66d9ef">main_var.go</span>:<span style="color:#ae81ff">7</span>)	<span style="color:#66d9ef">PCDATA</span>	<span style="color:#66d9ef">$0</span>, <span style="color:#66d9ef">$3</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>	<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0051</span> <span style="color:#ae81ff">00081</span> (<span style="color:#66d9ef">main_var.go</span>:<span style="color:#ae81ff">7</span>)	<span style="color:#66d9ef">MOVQ</span>	<span style="color:#66d9ef">AX</span>, <span style="color:#66d9ef">SI</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>	<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0054</span> <span style="color:#ae81ff">00084</span> (<span style="color:#66d9ef">main_var.go</span>:<span style="color:#ae81ff">7</span>)	<span style="color:#66d9ef">PCDATA</span>	<span style="color:#66d9ef">$0</span>, <span style="color:#66d9ef">$1</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>	<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0054</span> <span style="color:#ae81ff">00084</span> (<span style="color:#66d9ef">main_var.go</span>:<span style="color:#ae81ff">7</span>)	<span style="color:#66d9ef">DUFFCOPY</span>	<span style="color:#66d9ef">$826</span> <span style="color:#75715e"># copy content of the struct
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span><span style="color:#75715e"></span>	<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0067</span> <span style="color:#ae81ff">00103</span> (<span style="color:#66d9ef">main_var.go</span>:<span style="color:#ae81ff">7</span>)	<span style="color:#66d9ef">INCQ</span>	<span style="color:#66d9ef">CX</span>           <span style="color:#75715e"># CX++
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span><span style="color:#75715e"></span>	<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x006a</span> <span style="color:#ae81ff">00106</span> (<span style="color:#66d9ef">main_var.go</span>:<span style="color:#ae81ff">7</span>)	<span style="color:#66d9ef">CMPQ</span>	<span style="color:#66d9ef">CX</span>, <span style="color:#66d9ef">$1000000</span> <span style="color:#75715e"># CX &lt; 1000000
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span><span style="color:#75715e"></span>	<span style="color:#960050;background-color:#1e0010">0</span><span style="color:#a6e22e">x0071</span> <span style="color:#ae81ff">00113</span> (<span style="color:#66d9ef">main_var.go</span>:<span style="color:#ae81ff">7</span>)	<span style="color:#66d9ef">JLT</span>	<span style="color:#ae81ff">72</span>               <span style="color:#75715e"># JUMP to 0072 (next iteration)
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">...</span>
</span></span></code></pre></div><p>The conclusion is that with 80 bytes struct, every iteration copies the value of the element.</p>
<h2 id="ssa-optimization">SSA Optimization</h2>
<p>To understand how this code is generated, we first need to understand how GO compile a source code.</p>
<p><em>Stream</em> wrote a very good introduction to the topic on
<a href="https://getstream.io/blog/how-a-go-program-compiles-down-to-machine-code/">How a Go Program Compiles down to Machine Code</a>.<br>
The short version is the compiler does:</p>
<ol>
<li>break up the source code content into tokens (Scanning)</li>
<li>Construct Abstract Syntax Tree using the tokens (Parsing)</li>
<li>Generate Intermediate Representation (IR) with <a href="https://en.wikipedia.org/wiki/Static_single_assignment_form">Static Single Assignment (SSA) form</a></li>
<li>Iteratively optimize the IR with <a href="https://github.com/golang/go/blob/go1.14.1/src/cmd/compile/internal/ssa/compile.go#L398-L451">multiple pass</a></li>
</ol>
<br/>
Fortunately GO provides amazing tool that helps us getting more insight into the optimization process.
We can generate the SSA output for each stage of transformation with:
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>$ GOSSAFUNC<span style="color:#f92672">=</span>main go tool compile -S main_var.go type_small.go
</span></span></code></pre></div><br/>
The command will generate `ssa.html` in the same folder.
<p>Each column represents the optimization pass, and the result of the IR code.
When we click on a block, variable, or line. It will colorize the associated element, so we can track changes easily.</p>
<a href="forVar_small_ssa.png">
![Generated SSA HTML](forVar_small_ssa.png)
</a>
<br/>
<p>After comparing each step, I found out that the generated code was identical until the <code>writebarrier</code> pass.
let&rsquo;s focus on block <code>b6</code></p>
<p><strong><code>writebarrier</code></strong> (identical on both versions)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>b6: ← b3 b4
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>    v22 (7) = Phi &lt;*SomeStruct&gt; v14 v45
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>    v28 (7) = Phi &lt;int&gt; v16 v37
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span>    v23 (7) = Phi &lt;mem&gt; v12 v27
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span>    v37 (+7) = Add64 &lt;int&gt; v28 v36
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span><span>    v39 (7) = Less64 &lt;bool&gt; v37 v8
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7</span><span>    v25 (7) = VarDef &lt;mem&gt; {.autotmp_7} v23
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8</span><span>    v26 (7) = LocalAddr &lt;*SomeStruct&gt; {.autotmp_7} v2 v25
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9</span><span>    v27 (+7) = Move &lt;mem&gt; {SomeStruct} [72] v26 v22 v25
</span></span></code></pre></div><p>If you see on <code>v26 &amp; v27</code>, it does <code>Move</code> (or Copy) the content of the struct to local variable <code>autotmp_7</code>.</p>
<p>The <code>lower</code> pass basically convert the IR code into specific architecture low level code. Let&rsquo;s have a look at the generated output.
Don&rsquo;t be afraid if you don&rsquo;t really understand the assembly. What I wanted to show is the different code that was generated during
the <code>lower</code> pass.</p>
<p><strong><code>lower</code> with 9 int64</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span>b6: <span style="color:#960050;background-color:#1e0010">←</span> b3 b4
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>    v22 (<span style="color:#ae81ff">7</span>) <span style="color:#f92672">=</span> Phi <span style="color:#f92672">&lt;*</span>SomeStruct<span style="color:#f92672">&gt;</span> v14 v45
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>    v28 (<span style="color:#ae81ff">7</span>) <span style="color:#f92672">=</span> Phi <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">int</span><span style="color:#f92672">&gt;</span> v16 v37
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>    v23 (<span style="color:#ae81ff">7</span>) <span style="color:#f92672">=</span> Phi <span style="color:#f92672">&lt;</span>mem<span style="color:#f92672">&gt;</span> v12 v27
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>    v37 (<span style="color:#f92672">+</span><span style="color:#ae81ff">7</span>) <span style="color:#f92672">=</span> ADDQconst <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">int</span><span style="color:#f92672">&gt;</span> [<span style="color:#ae81ff">1</span>] v28
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>    v25 (<span style="color:#ae81ff">7</span>) <span style="color:#f92672">=</span> VarDef <span style="color:#f92672">&lt;</span>mem<span style="color:#f92672">&gt;</span> {<span style="color:#f92672">.</span>autotmp_7} v23
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>    v26 (<span style="color:#ae81ff">7</span>) <span style="color:#f92672">=</span> LEAQ <span style="color:#f92672">&lt;*</span>SomeStruct<span style="color:#f92672">&gt;</span> {<span style="color:#f92672">.</span>autotmp_7} v2
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>    v44 (<span style="color:#ae81ff">7</span>) <span style="color:#f92672">=</span> CMPQconst <span style="color:#f92672">&lt;</span>flags<span style="color:#f92672">&gt;</span> [<span style="color:#ae81ff">1000000</span>] v37 
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>    v32 (<span style="color:#f92672">+</span><span style="color:#ae81ff">7</span>) <span style="color:#f92672">=</span> LEAQ <span style="color:#f92672">&lt;*</span>SomeStruct<span style="color:#f92672">&gt;</span> {<span style="color:#f92672">.</span>autotmp_7} [<span style="color:#ae81ff">8</span>] v2
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>    v31 (<span style="color:#f92672">+</span><span style="color:#ae81ff">7</span>) <span style="color:#f92672">=</span> ADDQconst <span style="color:#f92672">&lt;*</span>SomeStruct<span style="color:#f92672">&gt;</span> [<span style="color:#ae81ff">8</span>] v22
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>    v29 (<span style="color:#f92672">+</span><span style="color:#ae81ff">7</span>) <span style="color:#f92672">=</span> MOVQload <span style="color:#f92672">&lt;</span>uint64<span style="color:#f92672">&gt;</span> v22 v25
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>    v24 (<span style="color:#f92672">+</span><span style="color:#ae81ff">7</span>) <span style="color:#f92672">=</span> LEAQ <span style="color:#f92672">&lt;*</span>SomeStruct<span style="color:#f92672">&gt;</span> {<span style="color:#f92672">.</span>autotmp_7} [<span style="color:#ae81ff">40</span>] v2
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span>    v15 (<span style="color:#f92672">+</span><span style="color:#ae81ff">7</span>) <span style="color:#f92672">=</span> ADDQconst <span style="color:#f92672">&lt;*</span>SomeStruct<span style="color:#f92672">&gt;</span> [<span style="color:#ae81ff">40</span>] v22
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span>    v46 (<span style="color:#f92672">+</span><span style="color:#ae81ff">7</span>) <span style="color:#f92672">=</span> LEAQ <span style="color:#f92672">&lt;*</span>SomeStruct<span style="color:#f92672">&gt;</span> {<span style="color:#f92672">.</span>autotmp_7} [<span style="color:#ae81ff">56</span>] v2
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span>    v35 (<span style="color:#f92672">+</span><span style="color:#ae81ff">7</span>) <span style="color:#f92672">=</span> ADDQconst <span style="color:#f92672">&lt;*</span>SomeStruct<span style="color:#f92672">&gt;</span> [<span style="color:#ae81ff">56</span>] v22
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span><span>    v21 (<span style="color:#f92672">+</span><span style="color:#ae81ff">7</span>) <span style="color:#f92672">=</span> LEAQ <span style="color:#f92672">&lt;*</span>SomeStruct<span style="color:#f92672">&gt;</span> {<span style="color:#f92672">.</span>autotmp_7} [<span style="color:#ae81ff">24</span>] v2
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span><span>    v17 (<span style="color:#f92672">+</span><span style="color:#ae81ff">7</span>) <span style="color:#f92672">=</span> ADDQconst <span style="color:#f92672">&lt;*</span>SomeStruct<span style="color:#f92672">&gt;</span> [<span style="color:#ae81ff">24</span>] v22
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span><span>    v39 (<span style="color:#ae81ff">7</span>) <span style="color:#f92672">=</span> SETL <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">bool</span><span style="color:#f92672">&gt;</span> v44
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span><span>    v42 (<span style="color:#ae81ff">7</span>) <span style="color:#f92672">=</span> TESTB <span style="color:#f92672">&lt;</span>flags<span style="color:#f92672">&gt;</span> v39 v39
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span><span>    v30 (<span style="color:#f92672">+</span><span style="color:#ae81ff">7</span>) <span style="color:#f92672">=</span> MOVQstore <span style="color:#f92672">&lt;</span>mem<span style="color:#f92672">&gt;</span> {<span style="color:#f92672">.</span>autotmp_7} v2 v29 v25  <span style="color:#75715e"># &lt;-- start translated Move instruction</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span><span>    v41 (<span style="color:#f92672">+</span><span style="color:#ae81ff">7</span>) <span style="color:#f92672">=</span> MOVOload <span style="color:#f92672">&lt;</span>int128<span style="color:#f92672">&gt;</span> [<span style="color:#ae81ff">8</span>] v22 v30
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span><span>    v20 (<span style="color:#f92672">+</span><span style="color:#ae81ff">7</span>) <span style="color:#f92672">=</span> MOVOstore <span style="color:#f92672">&lt;</span>mem<span style="color:#f92672">&gt;</span> {<span style="color:#f92672">.</span>autotmp_7} [<span style="color:#ae81ff">8</span>] v2 v41 v30
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span><span>    v34 (<span style="color:#f92672">+</span><span style="color:#ae81ff">7</span>) <span style="color:#f92672">=</span> MOVOload <span style="color:#f92672">&lt;</span>int128<span style="color:#f92672">&gt;</span> [<span style="color:#ae81ff">24</span>] v22 v20
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span><span>    v19 (<span style="color:#f92672">+</span><span style="color:#ae81ff">7</span>) <span style="color:#f92672">=</span> MOVOstore <span style="color:#f92672">&lt;</span>mem<span style="color:#f92672">&gt;</span> {<span style="color:#f92672">.</span>autotmp_7} [<span style="color:#ae81ff">24</span>] v2 v34 v20
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span><span>    v33 (<span style="color:#f92672">+</span><span style="color:#ae81ff">7</span>) <span style="color:#f92672">=</span> MOVOload <span style="color:#f92672">&lt;</span>int128<span style="color:#f92672">&gt;</span> [<span style="color:#ae81ff">40</span>] v22 v19
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span><span>    v38 (<span style="color:#f92672">+</span><span style="color:#ae81ff">7</span>) <span style="color:#f92672">=</span> MOVOstore <span style="color:#f92672">&lt;</span>mem<span style="color:#f92672">&gt;</span> {<span style="color:#f92672">.</span>autotmp_7} [<span style="color:#ae81ff">40</span>] v2 v33 v19
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span><span>    v47 (<span style="color:#f92672">+</span><span style="color:#ae81ff">7</span>) <span style="color:#f92672">=</span> MOVOload <span style="color:#f92672">&lt;</span>int128<span style="color:#f92672">&gt;</span> [<span style="color:#ae81ff">56</span>] v22 v38
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span><span>    v27 (<span style="color:#f92672">+</span><span style="color:#ae81ff">7</span>) <span style="color:#f92672">=</span> MOVOstore <span style="color:#f92672">&lt;</span>mem<span style="color:#f92672">&gt;</span> {<span style="color:#f92672">.</span>autotmp_7} [<span style="color:#ae81ff">56</span>] v2 v47 v38
</span></span></code></pre></div><br/>
**`lower` with 10 int64**
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span>b6: <span style="color:#960050;background-color:#1e0010">←</span> b3 b4
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>    v22 (<span style="color:#ae81ff">7</span>) <span style="color:#f92672">=</span> Phi <span style="color:#f92672">&lt;*</span>SomeStruct<span style="color:#f92672">&gt;</span> v14 v45
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>    v28 (<span style="color:#ae81ff">7</span>) <span style="color:#f92672">=</span> Phi <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">int</span><span style="color:#f92672">&gt;</span> v16 v37
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>    v23 (<span style="color:#ae81ff">7</span>) <span style="color:#f92672">=</span> Phi <span style="color:#f92672">&lt;</span>mem<span style="color:#f92672">&gt;</span> v12 v27
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>    v37 (<span style="color:#f92672">+</span><span style="color:#ae81ff">7</span>) <span style="color:#f92672">=</span> ADDQconst <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">int</span><span style="color:#f92672">&gt;</span> [<span style="color:#ae81ff">1</span>] v28
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>    v25 (<span style="color:#ae81ff">7</span>) <span style="color:#f92672">=</span> VarDef <span style="color:#f92672">&lt;</span>mem<span style="color:#f92672">&gt;</span> {<span style="color:#f92672">.</span>autotmp_7} v23
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>    v26 (<span style="color:#ae81ff">7</span>) <span style="color:#f92672">=</span> LEAQ <span style="color:#f92672">&lt;*</span>SomeStruct<span style="color:#f92672">&gt;</span> {<span style="color:#f92672">.</span>autotmp_7} v2
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>    v44 (<span style="color:#ae81ff">7</span>) <span style="color:#f92672">=</span> CMPQconst <span style="color:#f92672">&lt;</span>flags<span style="color:#f92672">&gt;</span> [<span style="color:#ae81ff">1000000</span>] v37
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>    v32 (<span style="color:#f92672">+</span><span style="color:#ae81ff">7</span>) <span style="color:#f92672">=</span> LEAQ <span style="color:#f92672">&lt;*</span>SomeStruct<span style="color:#f92672">&gt;</span> {<span style="color:#f92672">.</span>autotmp_7} [<span style="color:#ae81ff">8</span>] v2
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>    v31 (<span style="color:#f92672">+</span><span style="color:#ae81ff">7</span>) <span style="color:#f92672">=</span> ADDQconst <span style="color:#f92672">&lt;*</span>SomeStruct<span style="color:#f92672">&gt;</span> [<span style="color:#ae81ff">8</span>] v22
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>    v29 (<span style="color:#f92672">+</span><span style="color:#ae81ff">7</span>) <span style="color:#f92672">=</span> MOVQload <span style="color:#f92672">&lt;</span>uint64<span style="color:#f92672">&gt;</span> v22 v25
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>    v39 (<span style="color:#ae81ff">7</span>) <span style="color:#f92672">=</span> SETL <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">bool</span><span style="color:#f92672">&gt;</span> v44
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span>    v42 (<span style="color:#ae81ff">7</span>) <span style="color:#f92672">=</span> TESTB <span style="color:#f92672">&lt;</span>flags<span style="color:#f92672">&gt;</span> v39 v39
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span>    v30 (<span style="color:#f92672">+</span><span style="color:#ae81ff">7</span>) <span style="color:#f92672">=</span> MOVQstore <span style="color:#f92672">&lt;</span>mem<span style="color:#f92672">&gt;</span> {<span style="color:#f92672">.</span>autotmp_7} v2 v29 v25 <span style="color:#75715e"># &lt;-- start translated Move instruction</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span>    v27 (<span style="color:#f92672">+</span><span style="color:#ae81ff">7</span>) <span style="color:#f92672">=</span> DUFFCOPY <span style="color:#f92672">&lt;</span>mem<span style="color:#f92672">&gt;</span> [<span style="color:#ae81ff">826</span>] v32 v31 v30
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span><span>LT v44 <span style="color:#960050;background-color:#1e0010">→</span> b4 b2 (likely) (<span style="color:#ae81ff">7</span>)
</span></span></code></pre></div><br/>
<p>The later version uses <code>DUFFCOPY</code> to perform the Move operation. This logic I believe is due to a rewrite rule
<a href="https://golang.org/src/cmd/compile/internal/ssa/rewriteAMD64.go#L54445">rewriteAMD64.go</a>. It&rsquo;s an optimization
to Move a large byte on memory.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>// match: (Move [s] dst src mem)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>// cond: s &gt; 64 &amp;&amp; s &lt;= 16*64 &amp;&amp; s%16 == 0 &amp;&amp; !config.noDuffDevice
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>// result: (DUFFCOPY [14*(64-s/16)] dst src mem)
</span></span></code></pre></div><br/>
<p>At a later SSA pass (<code>elim unread autos</code>) the compiler can detect that there are unused temporary
variable for the first version (9 int64 struct). Thus, the <code>Move</code> instruction can be removed.
This is not the case with for the `DUFFCOPY&rsquo; version.
That&rsquo;s why the generated machine code is less optimized than the previous.</p>
<p>Note:
A <a href="https://en.wikipedia.org/wiki/Duff%27s_device">Duff Device</a> is a loop optimization by splitting the task
and reduce the number of loop.</p>
<h2 id="conclusion">Conclusion</h2>
<p><code>for-range</code> behaves differently depending on the struct size is due to Compiler SSA optimization. The compiler generated
a different machine code for the larger struct where at a later pass it did not detect unused variable. The opposite happen
for the smaller struct. At a later pass, it detected that some variables are un used. It removes the copy of element
instruction on each iteration.</p>

		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M4 0h8s2 0 4 2l15 15s2 2 0 4L21 31s-2 2-4 0L2 16s-2-2-2-4V3s0-3 4-3m3 10a3 3 0 0 0 0-6 3 3 0 0 0 0 6"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/en/tags/golang/" rel="tag">golang</a>
		</li>
	</ul>
</div>
		</footer>
	</article>
</main>

<div class="authorbox clearfix">
	<figure class="authorbox__avatar">
		<img alt="Ahmy Yulrizka avatar" src="/img/ahmy.jpg" class="avatar" height="90" width="90">
	</figure>
	<div class="authorbox__header">
		<span class="authorbox__name">About Ahmy Yulrizka</span>
	</div>
	<div class="authorbox__description">
		Software Engineer, Sports Enthusiast, and like to write about random things
	</div>
</div>

<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/en/en/cv/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Curriculum vitae</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/en/en/convert-intellij-live-template-to-vscode/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Convert Intellij Live Template to vscode Snippet</p>
		</a>
	</div>
</nav>

<section class="comments">
	<div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "labs-yulrizka" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>

			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 Ahmy Yulrizka.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>
</body>
</html>