<!DOCTYPE html>
<html lang="en">
<head>
<title>Ruby Fiber apaan sih ? | labs.yulrizka.com</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Artikel ini membahas penjelasan mengenai ruby fiber dan ruby thread. Fiber yang digunakan pada ruby 1.9">
<meta name="author" content="Ahmy Yulrizka">
<meta http-equiv="Content-Language" Content="id">
<meta name="keywords" content="fiber, ruby, thread, green thread" />
<meta http-equiv="date" content="2012-02-29T15:17:00+00:00" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="canonical" href="http://labs.yulrizka.com/">
<!-- Framework CSS -->
<link href="/stylesheets/application.css" media="screen, projection" rel="stylesheet" type="text/css" />

<!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->

<link href='http://fonts.googleapis.com/css?family=Slackey' rel='stylesheet' type='text/css'>
</head>
<body>
<div id="container" class="sidebar-right">
  <div class="container-fluid" id="main">
    <div class="row-fluid">
      <div id="content-wrapper" class="span9 ">
        <div class="content">
          <article>
            <h1>Ruby Fiber apaan sih ?</h1>
            <div class="posted_at">29 Feb 2012</div>

            <blockquote>
  <p>
    Fibers are light-weight (green) <a href="http://en.wikipedia.org/wiki/Thread_(computing)" alt="wiki Thread (Computing)">
      threads</a> with manual, cooperative scheduling, rather than the preemptive scheduling
    of Ruby 1.8's threads. Since Ruby 1.9's threads exist at the system level, fibers are, in a way,
    Ruby 1.9's answer to Ruby 1.8's green threads, but lacking the pre-emptive scheduling
  </p>
  <small>
    <a href="http://www.rubyinside.com/ruby-fibers-8-useful-reads-on-rubys-new-concurrency-feature-1769.html">
      rubyinside.com
    </a>
  </small>
</blockquote>

<h2>Thread</h2>

<p>Untuk dapat mengerti mengenai fiber, sebelumnya kita harus memahami thread. Suatu (<em>instance</em>) program yang sedang berjalan
disebut dengan proses. thread adalah unit proses (potongan kode) yang dapat dijalankan secara simultan. Jadi sekan-akan
program tersebut bercabang.</p>

<p>Ambil contoh program Web Server yang diimplementasi menggunakan thread. Fungsi Web Server (WS) adalah menerima request dan
memberikan response kepada web browser. Misalkan WS tersebut hanya memiliki 1 proses, maka apabila ada 10 user yang melakukan
request, maka mereka harus mengantri untuk menerima response dari server. Hal ini bisa diatasi salah satunya dengan menggunakan
thread. Apabila terdapat suatu request, maka proses utama membuat (<em>spawn</em>) suatu thread untuk menangani request tersebut.
Misalkan ada 10 request disaat yang bersamaan, maka terdapat 10 thread yang jalan disaat yang bersamaan. Dalam kasus ini
maka 10 user tersebut akan dilayani pada waktu yang bersamaan.</p>

<p>Ruby 1.8.7 (MRI) memiliki tipe <em>green thread</em>, yaitu thread yang dikelola oleh <em>Virtual Machine</em> sedangkan normalnya thread
dikelola oleh <em>Operating System</em> (OS) atau <em>native thread</em>. Namun implementasi threads untuk tiap interpreter berbeda. Misalkan
pada JRuby dan Rubinius yang menggunakan native threads.</p>

<p>Eksekusi setiap threads dikelola oleh program yang dinamakan <em>scheduler</em>. <em>preemptive scheduling</em> adalah suatu metode
yang digunakan <em>scheduler</em> dengan memanfaatkan <em>interrupt</em>. Artinya scheduler mengirimkan <em>interrupt</em> kepada suatu thread
untuk berhenti dan menjalankan thread lain. secara default MRI menggunakan <em>fair scheduler</em>. Artinya masing-masing thread
akan dijadwalkan (dijalankan) dengan waktu yang sama.</p>

<h2>Fiber</h2>

<p>Fiber adalah fitur yang pertamakali diperkenalkan pada ruby 1.9 (Meskipun ada hack untuk ruby 1.8.{67}).
Fiber mirip dengan thread. Namun pada fiber, user yang memiliki kontrol terhadap eksekusi kode, bukan <em>scheduler</em>.
setiap fiber memiliki 4Kb memori sehingga cukup &quot;murah&quot; untuk dibuat. Berikut adalah contoh dari (igvita.com).</p>

<p>Terdapat 2 thread: Thread pertama melakukan io-blocking selama 40ms dan komputasi 10ms. sedangkan
thread kedua melakukan 50ms komputasi.</p>

<p>Berikut adalah implementasi dalam thread dan juga fiber:
<div class="thumbnail">
  <img src="http://www.igvita.com/posts/09/fibers-vs-threads.png"></img>
  <div class="caption">
    Komparasi kode yang dijalankan menggunakan thread &nbsp; fiber.
    <a href="http://www.igvita.com/2009/05/13/fibers-cooperative-scheduling-in-ruby/">http://www.igvita.com/2009/05/13/fibers-cooperative-scheduling-in-ruby/</a>
  </div>
</div><br/></p>

<p>Pada contoh pertama, thread 2 memakan waktu 100ms, sedangkan pada contoh yang kedua hanya memakan waktu 60ms.</p>

<p>Dengan menggunakan fiber, program berjalan sekan-akan sychronous (blocking). Oleh karena itu fiber
merupakan kandidat yang cocok untuk diterapkan pada pemograman <em>Event-Driven</em> atau <em>Asynchronous programming</em> seperti
pada <em>EventMachine</em> di ruby</p>

<h2>Cara Menggunakan Fiber</h2>

<p>Untuk dapat memahami fiber, kita ambil contoh seperti berikut. Program ini sebenarnya tidak berguna, tapi cukup untuk
mendemonstrasikan alur penggunaan fiber</p>
<div class="code-listing"><table><tr><td class="lines language-ruby"><span class="line-number">1</span><span class="line-number">2</span><span class="line-number">3</span><span class="line-number">4</span><span class="line-number">5</span><span class="line-number">6</span><span class="line-number">7</span><span class="line-number">8</span><span class="line-number">9</span><span class="line-number">10</span><span class="line-number">11</span><span class="line-number">12</span><span class="line-number">13</span><span class="line-number">14</span></td><td><div class="highlight"><pre><div class="code-line" id="C1L1">  <span class="n">fiber</span> <span class="o">=</span> <span class="no">Fiber</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span></div><div class="code-line" id="C1L2">    <span class="nb">puts</span> <span class="s2">&quot;Fiber: Beginning of fiber&quot;</span></div><div class="code-line" id="C1L3">    <span class="no">Fiber</span><span class="o">.</span><span class="n">yield</span> <span class="c1"># kembalikan eksekusi ke main (line 11)</span></div><div class="code-line" id="C1L4">    <span class="nb">puts</span> <span class="s2">&quot;Fiber: Halo main, saya fiber&quot;</span></div><div class="code-line" id="C1L5">    <span class="no">Fiber</span><span class="o">.</span><span class="n">yield</span> <span class="c1"># kembalikan eksekusi ke main (line 13)</span></div><div class="code-line" id="C1L6">    <span class="no">Fiber</span><span class="o">.</span><span class="n">yield</span> <span class="s2">&quot;Fiber: Sekarang </span><span class="si">#{</span><span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">to_s</span><span class="si">}</span><span class="s2">&quot;</span></div><div class="code-line" id="C1L7">  <span class="k">end</span></div><div class="code-line" id="C1L8"><br></div><div class="code-line" id="C1L9">  <span class="nb">puts</span> <span class="s2">&quot;Main: Beginning main&quot;</span></div><div class="code-line" id="C1L10">  <span class="n">fiber</span><span class="o">.</span><span class="n">resume</span> <span class="c1"># jalankan fiber (line 2)</span></div><div class="code-line" id="C1L11">  <span class="nb">puts</span> <span class="s2">&quot;Main: Hello saya main thread&quot;</span></div><div class="code-line" id="C1L12">  <span class="n">fiber</span><span class="o">.</span><span class="n">resume</span> <span class="c1"># jalankan fiber (line 4)</span></div><div class="code-line" id="C1L13">  <span class="nb">puts</span> <span class="s2">&quot;Main: Sekarang jam berapa ya ?&quot;</span></div><div class="code-line" id="C1L14">  <span class="nb">puts</span> <span class="n">fiber</span><span class="o">.</span><span class="n">resume</span> <span class="c1"># jalankan fiber (line 6) dan output hasil</span></div></pre></div></td></tr></table></div>
<pre>
     Main: Beginning main
     Fiber: Beginning of fiber
     Main: Hello saya main thread
     Fiber: Halo main, saya fiber
     Main: Sekarang jam berapa ya ?
     Fiber: Sekarang 2012-02-29 22:45:08 +0700
</pre>


            <hr>
            <!-- AddThis Button BEGIN -->
            <div class="addthis_toolbox addthis_default_style addthis_32x32_style">
              <a class="addthis_button_facebook"></a>
              <a class="addthis_button_twitter"></a>
              <a class="addthis_button_google_plusone_share"></a>
              <a class="addthis_button_compact"></a><a class="addthis_counter addthis_bubble_style"></a>
            </div>
            <script type="text/javascript">var addthis_config = {"data_track_addressbar":true};</script>
            <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=yulrizka"></script>
            <!-- AddThis Button END -->
            <br>

            <b>Site related post:</b>
            
            <ul>
              <li><a href="/id/2012/03/scale-mongodb-dengan-sharding.html">Scale MongoDB dengan Sharding</a></li>
            </ul>
            
            <ul>
              <li><a href="/en/2013/02/homeward-light-indicator-with-raspberrypi-and-commonsense.html">Homeward light indicator with RaspberryPi and CommonSense</a></li>
            </ul>
            
            <ul>
              <li><a href="/en/2013/07/safely-sharing-credentials-with-pgp.html">Safely sharing credentials with PGP</a></li>
            </ul>
            
            <ul>
              <li><a href="/en/2012/02/responsive-design.html">Responsive Design</a></li>
            </ul>
            
            <ul>
              <li><a href="/en/2013/07/berks-upload-ruby-core-dump.html">berks upload core dump</a></li>
            </ul>
            
          </article>

          
          <div id="disqus_thread"></div>
          <script type="text/javascript">
              //var disqus_developer = 1;
              var disqus_shortname = 'labs-yulrizka';
              var disqus_identifier = '/id/2012/02/ruby-fiber-apaan-sih.html';

              /* * * DON'T EDIT BELOW THIS LINE * * */
              (function() {
                  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                  dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
              })();
          </script>
          <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          
        </div>
      </div>
      <div id="sidebar-wrapper" class="span3">
        <div class="sidebar">
          <aside>
          <h2>Archives</h2>
          <ul>
            

              
                <h3>2013</h3>
              

              <li>Jul <a href="/en/2013/07/my-account-just-got-hacked-by-romanian-possibly.html">My account just got hacked by Romanian (Possibly)</a></li>
            

              
                
                
                
              

              <li>Jul <a href="/en/2013/07/berks-upload-ruby-core-dump.html">berks upload core dump</a></li>
            

              
                
                
                
              

              <li>Jul <a href="/en/2013/07/safely-sharing-credentials-with-pgp.html">Safely sharing credentials with PGP</a></li>
            

              
                
                
                
              

              <li>Feb <a href="/en/2013/02/homeward-light-indicator-with-raspberrypi-and-commonsense.html">Homeward light indicator with RaspberryPi and CommonSense</a></li>
            

              
                
                
                
                  <h3>2012</h3>
                
              

              <li>Mar <a href="/id/2012/03/scale-mongodb-dengan-sharding.html">Scale MongoDB dengan Sharding</a></li>
            

              
                
                
                
              

              <li>Feb <a href="/id/2012/02/ruby-fiber-apaan-sih.html">Ruby Fiber apaan sih ?</a></li>
            

              
                
                
                
              

              <li>Feb <a href="/en/2012/02/responsive-design.html">Responsive Design</a></li>
            

              
                
                
                
              

              <li>Jan <a href="/en/2012/01/jekyll-error-utf-8-caracter.html">Jekyll error utf-8 caracter</a></li>
            

              
                
                
                
              

              <li>Jan <a href="/en/2012/01/testing-ruby-code-with-benchmark-suite.html">Testing ruby code with benchmark_suite</a></li>
            
          </ul>
          </aside>
        </div>
      </div>
    </div>
  </div>



  <header>
  <div id="banner">
    <div id="carousel-banner" class="wrapper carousel">
      <div class="carousel-inner excerpt">
        <div class="item active">
          <div class="image labs"></div>
          <div class="text">
            <p class="title">Let each man exercise the art he knows</p>
            <p>Welcome to my canvas. A place for me to explore and experiment on some stuff that I found interesting.</p>
          </div>
        </div>
        <div class="item">
          <div class="image ruby"></div>
          <div class="text">
            <p class="title">Ruby (and Rails) </p>
            <p>Ruby is a neat language. People create clean, elegant and smart app with it. Rails is web framework built on top of ruby. In this category I will explore stuff related to ruby and also rails</p>
          </div>
        </div>
        <div class="item">
          <div class="image web"></div>
          <div class="text">
            <p class="title">Web</p>
            <p>This is general category involving various aspect of web technology. I like to explore not only the programming and technology aspect of the web, but also the design </p>
          </div>
        </div>
        
      </div>
    </div> 
  </div>
  <div class="navbar navbar-fixed-top relative">  
    <div class="navbar-inner">    
      <div class="fill">
        <div class="container">
          <span class="brand" href="#">Labs.Yulrizka.com</span>
          <a class="btn btn-navbar" href="#" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <div id="page-view">
            <ul class="nav pull-right">
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" rel="popover" data-content="Arrange the sidebar position Left / Right / None" 
                data-original-title="Sidebar position" data-placement="left">
                  <i id="icon-panel" class="icon-right-panel icon-white"></i><b class="caret"></b>
                </a>
                <ul class="dropdown-menu">
                  <li><a href="#" id="sidebar-left-link"><i class="icon-left-panel"></i> Left Panel</a></li>
                  <li><a href="#" id="sidebar-none-link"><i class="icon-no-panel"></i> No Panel</a></li>
                  <li><a href="#" id="sidebar-right-link"><i class="icon-right-panel"></i> Right Panel</a></li>
                </ul>
              </li>
            </ul>
          </div>            
          <div id="social-icon" class="pull-right">
            <a href="https://twitter.com/#!/yulrizka" target="twitter" rel="popover" data-content="Follow me on twitter" data-original-title="@yulrizka" data-placement="left"><img src="/images/icon/twitter.png" alt="twitter"></a>  
            <a href="https://github.com/yulrizka" target="github" rel="popover" data-content="Github is source code repository that encourage social coding. Fork my projects from github." data-original-title="Fork me on Github" data-placement="left"><img src="/images/icon/github.png" alt="github"></a>  
            <a href="http://feeds.feedburner.com/yulrizka/labs" target="feed" rel="popover" data-content="Suscribe this blog feed on feed burner" data-original-title="RSS feed" data-placement="left"><img src="/images/icon/feed.png" alt="feed"></a>  
          </div>
          <div class="nav-link nav-collapse">
            <ul class="nav">
              <li class="active banner"><a href="/">Home</a></li>
              <li class=""><a href="/ruby/">Ruby (and Rails)</a></li>
              <li class=""><a href="/web/">Web</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>


  <footer>
  <div class="container-fluid">
    <div class="row-fluid">
      <div id="footer-wrapper" class="span9 <!-- sidebar-right -->">
        <div class="footer">
          <p>
            &copy; Ahmy Yulrizka 2012. This site is made with <a href="http://jekyllrb.com/">Jekyll</a>
            using <a href="http://twitter.github.com/bootstrap/">Twitter Bootstrap</a>
            and hosted on <a href="http://pages.github.com/">Github pages</a>.
            All of the content is open and the source can be accessed
            <a href="https://github.com/yulrizka/yulrizka.github.com/tree/source">here</a>
          </p>
        </div>
      </div>
    </div>
 </div>
</footer>

</div> <!-- end of #container-->

<!-- Grab Google CDN's jQuery, with a protocol relative URL; fall back to local if offline -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/javascripts/jquery-1.7.1.min.js"><\/script>')</script>
<script src="/javascripts/application.js"></script>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-22308054-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>


</body>
</html>
