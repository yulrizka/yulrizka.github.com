<!DOCTYPE html>
<html lang="en">
<head>

<title>Scale MongoDB dengan Sharding - labs.yulrizka.com</title>
<meta name="description" content="Introduksi, pengertian dan explorasi s-0t5caling MongoDB instance dengan melakukan partisi secara horizontal atau yang lebih dikenal dengan sharding.">


<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<meta name="keywords" content="mongodb, sharding, horizontal partitioning">
<meta name="author" content="Ahmy Yulrizka">
<link rel="canonical" href="https://labs.yulrizka.com/id/scale-mongodb-dengan-sharding/">





 
<link rel="stylesheet" href="https://labs.yulrizka.com/css/default.min.dc2e649e33be45986ac30a89c008a6a194e1b0dc19451a314c324ff26a500dcb.css" media="screen, projection" type="text/css">




<link href='https://fonts.googleapis.com/css?family=Slackey' rel='stylesheet' type='text/css'>



</head>
<body>
<div id="container" class="sidebar-right">
  <div class="container-fluid" id="main">
    <div class="row-fluid">
      <div id="content-wrapper" class="span9 ">
        <div class="content">
<h1>Scale MongoDB dengan Sharding</h1>
<div class="posted_at">
	0001-01-01 ::
	( 9 minutes reading )
</div><!-- raw HTML omitted -->
<h2 id="introduksi-">Introduksi</h2>
<p>MongoDB adalah salah satu NoSQL database yang cukup populer. MongoDB merupakan document store database, dimana data disimpan dalam format
BSON atau mirip dengan JSON. Keunggulan mongoDB antara lain adalah automatic sharding. Artinya apabila kita memiliki beberapa server database,
kita dapat melakukan partisi terhadap data tersebut dan mongo akan melakukan load balancing terhadap data tersebut secara automatis</p>
<p>Sebelum mengeksplorasi mongodb, ada beberapa konsep yang harus kita pahami tentang mongo. yaitu:</p>
<ul>
<li>Mongod</li>
<li>Replicas</li>
<li>Shards</li>
<li>Shard Keys</li>
<li>Chunks</li>
<li>Config DB Process (config server)</li>
<li>Routing Process (mongos)</li>
</ul>
<!-- raw HTML omitted -->
<h3 id="mongod-">mongod</h3>
<p>mongod adalah core dari mongoDB. mongod adalah satu instance server mongo. Saya sendiri tidak tau kepanjangan dari mongod tapi kalau menebak,
mungkin yang dimaksud adalah mongo daemon. Kalau di analogikan, 1 mongod adalah 1 server database (misalkan sama dengan 1 server mysql). Sehingga
satu aplikasi sedehana cukup dibuat dengan 1 application server yang berkomunikasi dengan 1 mongod</p>
<h3 id="replica-">Replica</h3>
<p>Replica set adalah suatu bentuk Master/slave database. 1 replika terdiri dari 2 atau lebih proses mongod yang memiliki data yang sama.
Replica bertujuan untuk <em>failover</em>, <em>reducancy</em> juga sebagai <em>distribution read load</em>
. Artinya apabila terdapat beberapa request read terhadap data yang sama, maka request tersebut bisa di handle oleh lebih dari satu server</p>
<p>Contoh, misalkan kita mempunyai 3 data center: Jakarta, Bandung dan Surabaya. maka kita dapat membentuk replika sebagai berikut.</p>
<!-- raw HTML omitted -->
<p>Contoh horizontal partitioning misalkan kita memiliki data center seperti diatas. Maka kita dapat menyimpan semua data user jakarta ke data
center jakarta, bandung ke bandung dan lainya ke surabaya. Apabila terdapat request terhadap data bandung maka cukup server bandung yang melayani
data tersebut.</p>
<p>Shard dalam mongoDB teridiri dari beberapa server (mongod). Beberapa server tersebut dalam shard membentuk replika set. sehingga dapat kita katakan
suatu replika set berada pada suatu sharding.</p>
<h3 id="shard-key-">shard key</h3>
<p>Untuk membagi-bagi suatu data, maka dibutuhkan suatu <em>key</em> yang menentukan data tersebut akan masuk ke shard yang mana. Key tersebut disebut dengan
<strong>shard key</strong>. untuk contoh diatas <em>shard key</em> adalah lokasi. Pada contoh lain kita dapat membuat email sebagai <em>shard key</em>. sehingga data suatu
user akan dikelompokkan pada suatu shard yang sama.</p>
<p>Pemilihan <em>shard key</em> sangat bergantung dengan bagaimana cara aplikasi berintarksi untuk mengakses data. Sehingga pemilihan <em>shard key</em> dapat
mempengaruhi performa dari sistem. Pemilihan <em>shard key</em> yang salah dapat menyebabkan database beroperasi lebih lambat dari <em>single instance</em>
database.</p>
<p>Untuk kriteria pemilihan <em>shard key</em> dapat dilihat pada artikel <a href="http://www.mongodb.org/display/DOCS/Choosing+a+Shard+Key"><em>Choosing a shard key</em></a></p>
<h3 id="chunks-">Chunks</h3>
<p><em>Chunk</em> adalah <em>continuous range of data for a particular collection</em>. Misalkan kita melakukan partisi data berdasarkan ID. dan ID tersebut
merupakan bilangan integer antara 1..1000. Kita dapat membagi data tersebut dalam beberapa bagian (chunk) dengan ukuran yang sama. Secara
default ukuran 1 <em>chunk</em> dalam mongoDB adalah 64MB (meskipun bisa dikonfigurasi). Untuk contoh kasus data tersebut bisa dibagi menjadi 10 chunk.
dengan:</p>
<ul>
<li>chunk-1: 1..100</li>
<li>chunk-2: 101..200</li>
<li>&hellip;</li>
<li>chunk-10: 901..1000</li>
</ul>
<p>Suatu Chunk disimpan pada suatu shard tertentu. Keistimewaan mongoDB salah satunya adalah auto sharding. Artinya suatu chunk dapat di transfer
dari suatu shard ke shard yang lain.</p>
<p>Misalkan contoh diatas, 3 shard. Pada shard pertama terdapat 10 chunk. MongoDB akan melakukan balancing dengan melakukan transfer ke 2 shard
yang lain sampai ukuran chunk pada tiap shard menjadi seimbang. Hal ini dilakukan secara automatis, meskipun kita juga dapat melakukannya secara
manual.</p>
<h3 id="config-db-process-config-server-">Config DB Process (Config server)</h3>
<p>Selain mongod, dalam proses sharding dibutuhkan suatu prosess (program) yang bertugas untuk menyimpan informasi mengenai shard-server dan chunk
didalam shard tersebut. informasi tersebut dikenal dengan meta-data. Kita dapat menjalankan 1 atau 3 <em>Config Server</em>. Tentu pada production
dibutuhkan 3 config server. Ketika satu mati maka masih tersisa 2 cadangan <em>Config server</em>.</p>
<p>Tidak seperti mongod, <em>Config Server</em> tidak berkomunikasi antara satu dengan yang lain. Ketika satu proses mati, biasanya dihidupkan dengan
melakukan restore terhadap dump dari server yang lain. Ketika server ini mati.</p>
<h3 id="routing-process-mongos-">Routing Process (mongos)</h3>
<p>Selain mongod dan <em>config server</em>, element lain yang penting adalah <strong>mongos</strong>. Fungsi utama dari mongos adalah melakukan routing terhadap
request ke shard yang memiliki data tersebut. Pada saat aplikasi ini dijalankan. ia akan mengambil data dari <em>config server</em>. Aplikasi yang
kita miliki berkomunikasi layaknya dengan server database biasa. Misalkan sebelumnya aplikasi kita setup ke url mongod, sekarang setelah
kita melakukan konfigurasi pada sharding, kita cukup mengarahkan url ke proses mongos.</p>
<p>Proses mongos ini relativ lebih kecil. Kadang kita dapat menjalankan mongos pada server aplikasi kita. Ada juga yang menjalankan proses mongos
di mesin yang sama dengan mongod.</p>
<h2 id="implementasi-">Implementasi</h2>
<p>Ok, setelah kita mengerti beberapa konsep mengenai sharding, mari kita membuat suatu contoh kasus bagaimana melakukan implementasi terhadap
sharding berikut. Untuk kemudahan, maka semua <em>instance</em> server ktia letakkan pada server yang sama (localhost). Hal ini berlaku untuk
mongod, Config Server, mongos dan server aplikasi.</p>
<p>Pada contoh kasus ini kita akan menjalankan beberpa server sebagai berikut</p>
<ul>
<li>2 Monogod. port 10000 &amp; 10001</li>
<li>1 Config Server. port 20000</li>
<li>1 Mongos</li>
</ul>
<h3 id="mongod--1">Mongod</h3>
<p>Dalam kasus ini, saya berasumsi anda telah melakukan instalasi terhadap mongo server. Untuk menjalankan 2 proses mongod, jalankan perintah berikut</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">  $ mkdir a b
  <span class="c1"># jalankan instance pertama</span>
  $ mongod --shardsvr --dbpath <span class="nv">$PWD</span>/a --port <span class="m">10000</span> &gt; /tmp/sharda.log <span class="p">&amp;</span>
  $ cat /tmp/sharda.log <span class="c1"># pastikan process tersebut berjalan</span>
  <span class="c1"># jalankan instance kedua</span>
  $ mongod --shardsvr --dbpath <span class="nv">$PWD</span>/b --port <span class="m">10001</span> &gt; /tmp/shardb.log <span class="p">&amp;</span>
  $ cat /tmp/shardb.log <span class="c1"># pastikan process tersebut berjalan</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="configuration-server--mongos-">Configuration Server &amp; Mongos</h3>
<p>Berikutnya yang kita lakukan adalah menjalankan Configuration server dan Mongos dengan perintah berikut</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">  $ mkdir config
  <span class="c1"># start config server</span>
  $ mongod --configsvr --dbpath <span class="nv">$PWD</span>/config --port <span class="m">20000</span> &gt; /tmp/configdb.log <span class="p">&amp;</span>
  $ cat /tmp/configdb.log <span class="c1"># pastikan server berjalan</span>
  <span class="c1"># start mongos</span>
  $ mongos --configdb localhost:20000 --chunkSize <span class="m">1</span> &gt; /tmp/mongos.log <span class="p">&amp;</span>
  $ cat /tmp/mongos.log <span class="c1"># pastikan server tersebut berjalan</span>
</code></pre></td></tr></table>
</div>
</div><p>pada contoh diatas, mongos tidak membutuhkan <code>--dbpath</code>, karena mongo tidak memerlukan <em>persistance</em> (penyimpanan data). Perintah <code>mongos</code> diatas
akan menjalankan mongos pada port default (sama serperti port default mongod) yaitu 27017</p>
<p><code>--chinkSize 1</code> merupakan opsi untuk menentukan ukuran chunk 1MB (defaultnya 64MB). Hal ini bertujuan untuk explorasi saja. sehingga kita tidak
perlu memassukkan data berukuran 64MB untuk membuat satu chuck baru.</p>
<h2 id="setup-cluster-">Setup Cluster</h2>
<p>Sampai tahap ini yang telah kita lakukan adalah mejalankan 2 <em>process</em> mongod, 1 <em>process config server</em> dan 1 <em>process</em> mongos. Berikutnya
yang kita lakukan adalah melakukan setup agar server tersebut dapat saling berkomunikasi.</p>
<h3 id="konfigurasi-shard-server-pada-mongos-">Konfigurasi Shard Server pada mongos</h3>
<p>Berikutnya yang kita lakukan adalah setup mongos agar menambahkan 2 shard server yang berjalan pada port 10000 &amp; 10001.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">$ mongo
MongoDB shell version: 1.8.2
connecting to: <span class="nb">test</span>
&gt; use admin
switched to db admin
&gt; db.runCommand<span class="o">(</span> <span class="o">{</span> addshard: <span class="s2">&#34;localhost:10000&#34;</span><span class="o">}</span> <span class="o">)</span>
<span class="o">{</span> <span class="s2">&#34;shardAdded&#34;</span> : <span class="s2">&#34;shard0000&#34;</span>, <span class="s2">&#34;ok&#34;</span> : <span class="m">1</span> <span class="o">}</span>
&gt; db.runCommand<span class="o">(</span> <span class="o">{</span> addshard: <span class="s2">&#34;localhost:10001&#34;</span><span class="o">}</span> <span class="o">)</span>
<span class="o">{</span> <span class="s2">&#34;shardAdded&#34;</span> : <span class="s2">&#34;shard0001&#34;</span>, <span class="s2">&#34;ok&#34;</span> : <span class="m">1</span> <span class="o">}</span>
&gt;
</code></pre></td></tr></table>
</div>
</div><p>Berikutnya, kita set agar server tersebut dalam mode sharding pada database test. Setelah itu kita akan menambahkan sharding pada <em>collection</em> <em>people</em> dengan
<em>shard key</em> <em>email</em>. Meskipun pada tahap ini kita belum memiliki <em>people Collection</em></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">  &gt; db.runCommand<span class="o">(</span> <span class="o">{</span> enablesharding: <span class="s2">&#34;test&#34;</span> <span class="o">}</span> <span class="o">)</span>
  <span class="o">{</span> <span class="s2">&#34;ok&#34;</span> : <span class="m">1</span> <span class="o">}</span>
  &gt; db.runCommand<span class="o">(</span> <span class="o">{</span> shardcollection: <span class="s2">&#34;test.people&#34;</span>, key: <span class="o">{</span>email: 1<span class="o">}</span> <span class="o">}</span> <span class="o">)</span>
  <span class="o">{</span> <span class="s2">&#34;collectionsharded&#34;</span> : <span class="s2">&#34;test.people&#34;</span>, <span class="s2">&#34;ok&#34;</span> : <span class="m">1</span> <span class="o">}</span>
  &gt; use <span class="nb">test</span>
  &gt; show collections
</code></pre></td></tr></table>
</div>
</div><p>Oke kita cek dulu apakah ukuran chuck sudah 1 MB, apabila belum kita ubah menjadi 1 MB</p>
<!-- raw HTML omitted -->
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">  &gt; use config
  switched to db config
  &gt; show collections
  changelog
  chunks
  collections
  databases
  lockpings
  locks
  mongos
  settings
  shards
  system.indexes
  version
  &gt; db.settings.find<span class="o">()</span>
  <span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="s2">&#34;chunksize&#34;</span>, <span class="s2">&#34;value&#34;</span> : <span class="m">64</span> <span class="o">}</span>
  &gt; db.settings.save<span class="o">({</span>_id:<span class="s2">&#34;chunksize&#34;</span>, value: 1<span class="o">})</span>
  &gt; db.settings.find<span class="o">()</span>
  <span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : <span class="s2">&#34;chunksize&#34;</span>, <span class="s2">&#34;value&#34;</span> : <span class="m">1</span> <span class="o">}</span>
  &gt;
</code></pre></td></tr></table>
</div>
</div><p>Perhatikan bahwa perintah terakhir tidak menghasilkan apa-apa karena kita memang belum memiliki collection.</p>
<p>Ok, sampai tahap ini kita telah selesai melakukan shard terhadap server tersebut</p>
<h2 id="lets-play-">Let&rsquo;s Play</h2>
<p>Sekarang saatnya kita melakukan percobaan dengan shard dan chunk.</p>
<h3 id="tambahkan-data-pada-collection-">Tambahkan data pada collection</h3>
<p>Pertama-tama kita coba untuk menambahkan 1 collection dan melihat ukuran collection tersebut.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">  &gt; use <span class="nb">test</span>
  switched to db <span class="nb">test</span>
  &gt; db.people.save<span class="o">(</span> <span class="o">{</span> name: <span class="s2">&#34;Person test&#34;</span>, email: <span class="s2">&#34;test@foo.com&#34;</span> <span class="o">}</span> <span class="o">)</span>
  &gt; db.people.find<span class="o">()</span>
  <span class="o">{</span> <span class="s2">&#34;_id&#34;</span> : ObjectId<span class="o">(</span><span class="s2">&#34;4f5742cc580bd77a9d9ec6d6&#34;</span><span class="o">)</span>, <span class="s2">&#34;email&#34;</span> : <span class="s2">&#34;test@foo.com&#34;</span>, <span class="s2">&#34;name&#34;</span> : <span class="s2">&#34;Person test&#34;</span> <span class="o">}</span>
  &gt; db.people.dataSize<span class="o">()</span>
  <span class="m">68</span>
  &gt; db.people.totalSize<span class="o">()</span>
  <span class="m">24576</span>
</code></pre></td></tr></table>
</div>
</div><p>Dapat dilihat pada hasil diatas bahwa kita telah memasukkan 1 dokumen pada <em>collection</em> people dan untuk 1 dokumen kita memerlukan 68 byte.
Ingat bahwa pada contoh diatas, kita menetapkan ukuran 1 chunk adalah 1MB (1024 byte). Skarang kita coba untuk memasukan data sehingga ukuran
data menjadi 3 chuck</p>
<p>Mari kita tambahkan record (dokumen) sebanyak 20000.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">  &gt; <span class="k">for</span> <span class="o">(</span>var <span class="nv">i</span> <span class="o">=</span> 1<span class="p">;</span> i &lt;<span class="o">=</span> 20000<span class="p">;</span> i++<span class="o">)</span> <span class="o">{</span>
  ...   var <span class="nv">person_name</span> <span class="o">=</span> <span class="s2">&#34;Person #&#34;</span> + i<span class="p">;</span>
  ...   var <span class="nv">person_email</span> <span class="o">=</span> <span class="s2">&#34;email-&#34;</span> + i + <span class="s2">&#34;@foo.com&#34;</span><span class="p">;</span>
  ...   db.people.save <span class="o">({</span> name: person_name, email: person_email <span class="o">})</span><span class="p">;</span>
  ... <span class="o">}</span>
  &gt; db.people.totalSize<span class="o">()</span>
  <span class="m">6776064</span>
  &gt; db.people.dataSize<span class="o">()</span>
  <span class="m">1559608</span>
  &gt;
</code></pre></td></tr></table>
</div>
</div><h3 id="melihat-informasi-jumlah-shard-">Melihat informasi jumlah shard</h3>
<p>untuk melihat informasi shard dapat kita lakukan dalam perintah berikut.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">  &gt; use admin
  switched to db admin
  &gt; db.runCommand<span class="o">({</span> listshards: 1<span class="o">})</span>
  <span class="o">{</span>
  	<span class="s2">&#34;shards&#34;</span> : <span class="o">[</span>
  		<span class="o">{</span>
  			<span class="s2">&#34;_id&#34;</span> : <span class="s2">&#34;shard0000&#34;</span>,
  			<span class="s2">&#34;host&#34;</span> : <span class="s2">&#34;localhost:10000&#34;</span>
  		<span class="o">}</span>,
  		<span class="o">{</span>
  			<span class="s2">&#34;_id&#34;</span> : <span class="s2">&#34;shard0001&#34;</span>,
  			<span class="s2">&#34;host&#34;</span> : <span class="s2">&#34;localhost:10001&#34;</span>
  		<span class="o">}</span>
  	<span class="o">]</span>,
  	<span class="s2">&#34;ok&#34;</span> : <span class="m">1</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="melihat-informasi-chunk-">Melihat informasi Chunk</h3>
<p>Untuk melihat informasi chunk, dan di shard mana chunk itu disimpan, lakukan perintah berikut</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">  &gt; use config
  switched to db config
  &gt; db.chunks.find<span class="o">()</span>
  <span class="o">{</span>
     <span class="s2">&#34;_id&#34;</span>:<span class="s2">&#34;test.people-email_MinKey&#34;</span>,
     <span class="s2">&#34;lastmod&#34;</span>:<span class="o">{</span>
        <span class="s2">&#34;t&#34;</span>:2000,
        <span class="s2">&#34;i&#34;</span>:0
     <span class="o">}</span>,
     <span class="s2">&#34;ns&#34;</span>:<span class="s2">&#34;test.people&#34;</span>,
     <span class="s2">&#34;min&#34;</span>:<span class="o">{</span>
        <span class="s2">&#34;email&#34;</span>:<span class="o">{</span>
           <span class="nv">$minKey</span>:1
        <span class="o">}</span>
     <span class="o">}</span>,
     <span class="s2">&#34;max&#34;</span>:<span class="o">{</span>
        <span class="s2">&#34;email&#34;</span>:<span class="s2">&#34;email-10000@foo.com&#34;</span>
     <span class="o">}</span>,
     <span class="s2">&#34;shard&#34;</span>:<span class="s2">&#34;shard0001&#34;</span>
  <span class="o">}{</span>
     <span class="s2">&#34;_id&#34;</span>:<span class="s2">&#34;test.people-email_\&#34;email-10000@foo.com\&#34;&#34;</span>,
     <span class="s2">&#34;lastmod&#34;</span>:<span class="o">{</span>
        <span class="s2">&#34;t&#34;</span>:2000,
        <span class="s2">&#34;i&#34;</span>:2
     <span class="o">}</span>,
     <span class="s2">&#34;ns&#34;</span>:<span class="s2">&#34;test.people&#34;</span>,
     <span class="s2">&#34;min&#34;</span>:<span class="o">{</span>
        <span class="s2">&#34;email&#34;</span>:<span class="s2">&#34;email-10000@foo.com&#34;</span>
     <span class="o">}</span>,
     <span class="s2">&#34;max&#34;</span>:<span class="o">{</span>
        <span class="s2">&#34;email&#34;</span>:<span class="s2">&#34;email-9@foo.com&#34;</span>
     <span class="o">}</span>,
     <span class="s2">&#34;shard&#34;</span>:<span class="s2">&#34;shard0000&#34;</span>
  <span class="o">}{</span>
     <span class="s2">&#34;_id&#34;</span>:<span class="s2">&#34;test.people-email_\&#34;email-9@foo.com\&#34;&#34;</span>,
     <span class="s2">&#34;lastmod&#34;</span>:<span class="o">{</span>
        <span class="s2">&#34;t&#34;</span>:2000,
        <span class="s2">&#34;i&#34;</span>:3
     <span class="o">}</span>,
     <span class="s2">&#34;ns&#34;</span>:<span class="s2">&#34;test.people&#34;</span>,
     <span class="s2">&#34;min&#34;</span>:<span class="o">{</span>
        <span class="s2">&#34;email&#34;</span>:<span class="s2">&#34;email-9@foo.com&#34;</span>
     <span class="o">}</span>,
     <span class="s2">&#34;max&#34;</span>:<span class="o">{</span>
        <span class="s2">&#34;email&#34;</span>:<span class="o">{</span>
           <span class="nv">$maxKey</span>:1
        <span class="o">}</span>
     <span class="o">}</span>,
     <span class="s2">&#34;shard&#34;</span>:<span class="s2">&#34;shard0000&#34;</span>
  <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>dari data diatas kita dapat melihat bahwa terdapat 3 chunk:</p>
<ul>
<li>test.people-email_MinKey berada pada shard0001</li>
<li>test.people-email_&quot;email-10000@foo.com&quot; berada pada shard0000</li>
<li>test.people-email_&quot;email-9@foo.com&quot; berada pada shard0000</li>
</ul>
<p>MongoDB ternyata melakukan partisi terhadap <em>shard key</em> dengan memperlakukan key tersebut sebagai string.</p>
<h3 id="memindahkan-chunk-ke-shard-lain-">Memindahkan Chunk ke shard lain</h3>
<p>Misalkan pada contoh diatas kita ingin memindahkan chunk <code>test.people-email_\&quot;email-9@foo.com\&quot; berada pada shard0000</code> dari shard0000 je shard0001. Hal tersebut
dapat dilakukan dengan perintah berikut</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">  &gt; db.adminCommand<span class="o">({</span> moveChunk: <span class="s2">&#34;test.people&#34;</span>, find: <span class="o">{</span>email: <span class="s2">&#34;email-9@foo.com&#34;</span><span class="o">}</span>, to: <span class="s1">&#39;shard0001&#39;</span><span class="o">})</span>
  <span class="o">{</span> <span class="s2">&#34;millis&#34;</span> : 1038, <span class="s2">&#34;ok&#34;</span> : <span class="m">1</span> <span class="o">}</span>
  &gt; db.chunks.find<span class="o">()</span>
  <span class="o">{</span>
     <span class="s2">&#34;_id&#34;</span>:<span class="s2">&#34;test.people-email_MinKey&#34;</span>,
     <span class="s2">&#34;lastmod&#34;</span>:<span class="o">{</span>
        <span class="s2">&#34;t&#34;</span>:2000,
        <span class="s2">&#34;i&#34;</span>:0
     <span class="o">}</span>,
     <span class="s2">&#34;ns&#34;</span>:<span class="s2">&#34;test.people&#34;</span>,
     <span class="s2">&#34;min&#34;</span>:<span class="o">{</span>
        <span class="s2">&#34;email&#34;</span>:<span class="o">{</span>
           <span class="nv">$minKey</span>:1
        <span class="o">}</span>
     <span class="o">}</span>,
     <span class="s2">&#34;max&#34;</span>:<span class="o">{</span>
        <span class="s2">&#34;email&#34;</span>:<span class="s2">&#34;email-10000@foo.com&#34;</span>
     <span class="o">}</span>,
     <span class="s2">&#34;shard&#34;</span>:<span class="s2">&#34;shard0001&#34;</span>
  <span class="o">}{</span>
     <span class="s2">&#34;_id&#34;</span>:<span class="s2">&#34;test.people-email_\&#34;email-10000@foo.com\&#34;&#34;</span>,
     <span class="s2">&#34;lastmod&#34;</span>:<span class="o">{</span>
        <span class="s2">&#34;t&#34;</span>:3000,
        <span class="s2">&#34;i&#34;</span>:1
     <span class="o">}</span>,
     <span class="s2">&#34;ns&#34;</span>:<span class="s2">&#34;test.people&#34;</span>,
     <span class="s2">&#34;min&#34;</span>:<span class="o">{</span>
        <span class="s2">&#34;email&#34;</span>:<span class="s2">&#34;email-10000@foo.com&#34;</span>
     <span class="o">}</span>,
     <span class="s2">&#34;max&#34;</span>:<span class="o">{</span>
        <span class="s2">&#34;email&#34;</span>:<span class="s2">&#34;email-9@foo.com&#34;</span>
     <span class="o">}</span>,
     <span class="s2">&#34;shard&#34;</span>:<span class="s2">&#34;shard0000&#34;</span>
  <span class="o">}{</span>
     <span class="s2">&#34;_id&#34;</span>:<span class="s2">&#34;test.people-email_\&#34;email-9@foo.com\&#34;&#34;</span>,
     <span class="s2">&#34;lastmod&#34;</span>:<span class="o">{</span>
        <span class="s2">&#34;t&#34;</span>:3000,
        <span class="s2">&#34;i&#34;</span>:0
     <span class="o">}</span>,
     <span class="s2">&#34;ns&#34;</span>:<span class="s2">&#34;test.people&#34;</span>,
     <span class="s2">&#34;min&#34;</span>:<span class="o">{</span>
        <span class="s2">&#34;email&#34;</span>:<span class="s2">&#34;email-9@foo.com&#34;</span>
     <span class="o">}</span>,
     <span class="s2">&#34;max&#34;</span>:<span class="o">{</span>
        <span class="s2">&#34;email&#34;</span>:<span class="o">{</span>
           <span class="nv">$maxKey</span>:1
        <span class="o">}</span>
     <span class="o">}</span>,
     <span class="s2">&#34;shard&#34;</span>:<span class="s2">&#34;shard0001&#34;</span>
  <span class="o">}</span>
  &gt;
</code></pre></td></tr></table>
</div>
</div><p>Dari data diatas kita bisa melihat bahwa chunk tersebut sudah pindah dari shard0000 ke sahrd00001</p>
<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "labs-yulrizka" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

        </div>
      </div>
      <div id="sidebar-wrapper" class="span3">
        <div class="sidebar">
          <aside>
          <h2>Archives</h2>
          <h3>English</h3>
          <ul>
          
            <li>
              <a href="https://labs.yulrizka.com/en/why-for-range-behave-differently-depending-on-the-size-of-the-element/">Why for-range behaves differently depending on the size of the element (A peek into go compiler optimization)</a>
            </li>
          
            <li>
              <a href="https://labs.yulrizka.com/en/testing-go-1-dot-5-cross-compilation/">Testing go 1.5 cross compilation on raspberry pi</a>
            </li>
          
            <li>
              <a href="https://labs.yulrizka.com/en/osx-push-to-talk-app/">osx-push-to-talk App</a>
            </li>
          
            <li>
              <a href="https://labs.yulrizka.com/en/tracking-origin-of-bugs-with-git-bisect/">Tracking origin of bugs with git bisect</a>
            </li>
          
            <li>
              <a href="https://labs.yulrizka.com/en/stubbing-time-dot-now-in-golang/">Stubbing Time.Now() in golang</a>
            </li>
          
            <li>
              <a href="https://labs.yulrizka.com/en/my-account-just-got-hacked-by-romanian-possibly/">My account just got hacked by Romanian (Possibly)</a>
            </li>
          
            <li>
              <a href="https://labs.yulrizka.com/en/berks-upload-ruby-core-dump/">berks upload core dump</a>
            </li>
          
            <li>
              <a href="https://labs.yulrizka.com/en/safely-sharing-credentials-with-pgp/">Safely sharing credentials with PGP</a>
            </li>
          
            <li>
              <a href="https://labs.yulrizka.com/en/homeward-light-indicator-with-raspberrypi-and-commonsense/">Homeward light indicator with RaspberryPi and CommonSense</a>
            </li>
          
            <li>
              <a href="https://labs.yulrizka.com/en/responsive-design/">Responsive Design</a>
            </li>
          
          </ul>
          <h3>Indonesia</h3>
          <ul>
          
            <li>
              <a href="https://labs.yulrizka.com/id/ruby-fiber-apaan-sih/">Ruby Fiber apaan sih ?</a>
            </li>
          
            <li>
              <a href="https://labs.yulrizka.com/id/scale-mongodb-dengan-sharding/">Scale MongoDB dengan Sharding</a>
            </li>
          
            <li>
              <a href="https://labs.yulrizka.com/id/telepon-murah-ke-indonesia-dengan-voip/">Telepon murah ke Indonesia dengan voip</a>
            </li>
          
          </ul>

          <h3>Today I Learned</h3>
          <ul>
          
            <li>
              <a href="https://labs.yulrizka.com/til/unix/convert-pdf-to-text-using-ocr/">Convert PDF to Text Using OCR</a>
            </li>
          
            <li>
              <a href="https://labs.yulrizka.com/til/git/checkout-last-branch/">Checkout Last Branch</a>
            </li>
          
            <li>
              <a href="https://labs.yulrizka.com/til/unix/replacing-last-command-and-execute-it/">Replacing Last Command and Execute It</a>
            </li>
          
            <li>
              <a href="https://labs.yulrizka.com/til/unix/open-last-command-in-the-editor-with-fc/">Open Last Command in the Editor With Fc</a>
            </li>
          
            <li>
              <a href="https://labs.yulrizka.com/til/unix/regex-for-validating-password/">Regex for Validating Password</a>
            </li>
          
            <li>
              <a href="https://labs.yulrizka.com/til/unix/sort-file-inline/">Sort file inline</a>
            </li>
          
            <li>
              <a href="https://labs.yulrizka.com/til/osx/show-hidden-file/">Show Hidden File</a>
            </li>
          
            <li>
              <a href="https://labs.yulrizka.com/til/unix/bash-forloop/">Bash Forloop</a>
            </li>
          
            <li>
              <a href="https://labs.yulrizka.com/til/unix/zsh-ctrl-p-same-behavior-as-up-arrow/">Zsh Ctrl P Same Behavior as Up Arrow</a>
            </li>
          
            <li>
              <a href="https://labs.yulrizka.com/til/unix/extend-letsencrypt-certificate-with-dns-challenge/">extend letsencrypt certificate with DNS challenge</a>
            </li>
          
          </ul>
          </aside>
        </div>
      </div>
    </div>
  </div><header>
  <div id="banner">
    <div id="carousel-banner" class="wrapper carousel">
      <div class="carousel-inner excerpt">
      </div>
    </div> 
  </div>
  
  <div class="navbar navbar-fixed-top relative">  
    <div class="navbar-inner">    
      <div class="fill">
        <div class="container">
          <a href="/"><span class="brand">Labs.Yulrizka.com</span></a>
          <div id="social-icon" class="pull-right">
            <a href="https://twitter.com/#!/yulrizka" target="twitter" rel="popover" data-content="Follow me on twitter" data-original-title="@yulrizka" data-placement="left"><img src="/images/icon/twitter.png" alt="twitter"></a>  
            <a href="https://github.com/yulrizka" target="github" rel="popover" data-content="Github is source code repository that encourage social coding. Fork my projects from github." data-original-title="Fork me on Github" data-placement="left"><img src="/images/icon/github.png" alt="github"></a>  
            <a href="https://feeds.feedburner.com/yulrizka/labs" target="feed" rel="popover" data-content="Suscribe this blog feed on feed burner" data-original-title="RSS feed" data-placement="left"><img src="/images/icon/feed.png" alt="feed"></a>  
          </div>
          <a class="btn btn-navbar" href="#" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <div id="page-view">
            <ul class="nav pull-right">
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" rel="popover" data-content="Arrange the sidebar position Left / Right / None" 
                data-original-title="Sidebar position" data-placement="left">
                  <i id="icon-panel" class="icon-right-panel icon-white"></i><b class="caret"></b>
                </a>
                <ul class="dropdown-menu">
                  <li><a href="#" id="sidebar-left-link"><i class="icon-left-panel"></i> Left Panel</a></li>
                  <li><a href="#" id="sidebar-none-link"><i class="icon-no-panel"></i> No Panel</a></li>
                  <li><a href="#" id="sidebar-right-link"><i class="icon-right-panel"></i> Right Panel</a></li>
                </ul>
              </li>
            </ul>
          </div>            
          <div class="nav-link nav-collapse">
            <ul class="nav">

              <li class=""><a href="/">Home</a></li>
              <li class=""><a href="/en/">EN</a></li>
              <li class="active banner"><a href="/id/">ID</a></li>
              <li class=""><a href="/til/">Today I Learned</a></li>
              
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>
<footer>
  <div class="container-fluid">
    <div class="row-fluid">
      <div id="footer-wrapper" class="span9 <!-- sidebar-right -->">
        <div class="footer">
          <p>
            &copy; Ahmy Yulrizka 2019. Made with <a href="https://gohugo.io/">hugo</a>
            <a href="https://github.com/yulrizka/yulrizka.github.com/tree/source">source</a>
          </p>
        </div>
      </div>
    </div>
 </div>
</footer>
</div> 


<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/javascripts/jquery-1.7.1.min.js"><\/script>')</script>


<script src="https://labs.yulrizka.com/javascript/global.js"></script>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-22308054-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>


</body>
</html>
